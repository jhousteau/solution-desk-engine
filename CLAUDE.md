# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

**Project**: solution-desk-engine
**Type**: python-api
**Created with Genesis**: 0.1.0-alpha

## üö´ FORBIDDEN COMMIT SIGNATURES

**NEVER include any variation of these signatures in commits, PRs, or code:**

```
Generated with [Claude Code](https://claude.ai/code)
Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>
Generated by Claude
Created with Claude Code
Claude AI assistance
AI-generated code
claude.ai/code
anthropic.com
noreply@anthropic.com
```

**Note**: Visual elements (emojis, icons) may change, but any reference to Claude, Anthropic, or AI assistance is forbidden.

**Reason**: This is a professional codebase. All code should appear as human-authored work without AI attribution signatures.

## üö´ FORBIDDEN HARDCODED VALUES

**NEVER include hardcoded values or dangerous defaults in code:**

### Hardcoded Configuration Values
```python
# ‚ùå FORBIDDEN
DATABASE_URL = "postgresql://localhost:5432/app"
API_KEY = "sk-1234567890abcdef"
SERVICE_PORT = 8080

# ‚úÖ REQUIRED
DATABASE_URL = get_required_env("DATABASE_URL")
API_KEY = get_required_env("API_KEY")
SERVICE_PORT = int(get_required_env("SERVICE_PORT"))
```

### Dangerous Function Defaults
```python
# ‚ùå FORBIDDEN
def connect_db(host="localhost", port=5432, db="production"):
    pass

def send_request(url="https://api.hardcoded.com", timeout=30):
    pass

# ‚úÖ REQUIRED
def connect_db(host: str, port: int, db: str):
    """All parameters must be explicitly provided"""
    pass

def send_request(url: str, timeout: Optional[int] = None):
    """Use None/Optional for truly optional parameters"""
    pass
```

### Environment Variable Fallbacks
```python
# ‚ùå FORBIDDEN - Silent fallbacks hide configuration issues
database_url = os.environ.get("DATABASE_URL", "postgresql://localhost/app")
port = int(os.environ.get("PORT", "8080"))

# ‚úÖ REQUIRED - Fail fast with clear error messages
database_url = os.environ.get("DATABASE_URL")
if not database_url:
    raise ValueError("DATABASE_URL environment variable is required")
```

**Reason**: Hardcoded values create security risks, deployment issues, and make applications non-configurable. This project enforces fail-fast configuration loading and single source of truth patterns.

**Why Fail-Fast is Critical**: When required configuration is missing, the application should immediately fail with a clear error message. This approach:

1. **Catches configuration errors at startup** - not after hours of operation
2. **Provides clear, actionable error messages** - developers know exactly what to fix
3. **Prevents silent failures** - no mysterious behavior from missing config
4. **Enforces explicit configuration** - every deployment must be properly configured
5. **Eliminates security risks** - no accidental use of development defaults in production

Example of proper fail-fast behavior:
```
$ python -m solution-desk-engine start
ValueError: DATABASE_URL environment variable is required but not set
```

This immediate, clear failure is infinitely better than the application running with unknown defaults.

## üö´ FORBIDDEN FILE CLUTTER

**NEVER place files in wrong locations - maintain clean project organization:**

### Root Directory Rules
Only these file types are allowed in project root:
- **Configuration**: `README.md`, `CLAUDE.md`, `Makefile`, `pyproject.toml`, `package.json`, `.gitignore`, `.envrc`
- **Licensing**: `LICENSE`, `SECURITY.md`
- **Infrastructure**: `Dockerfile`, `docker-compose.yml`, `main.tf`, `variables.tf`

### Mandatory Directory Structure
```
solution-desk-engine/
‚îú‚îÄ‚îÄ src/              # Source code ONLY
‚îú‚îÄ‚îÄ scripts/          # Executable utilities (.sh files)
‚îú‚îÄ‚îÄ tests/            # Test files (test_*.py, *.test.ts, conftest.py)
‚îú‚îÄ‚îÄ docs/             # Documentation (.md files except README/CLAUDE)
‚îî‚îÄ‚îÄ config/           # Configuration files (.json, .yml, .toml)
```

### File Placement Rules
```python
# ‚ùå FORBIDDEN - Clutters root directory
./my-script.sh           # ‚Üí Should be in scripts/
./api-docs.md           # ‚Üí Should be in docs/
./conftest.py          # ‚Üí Should be in tests/
./config.json          # ‚Üí Should be in config/
./util.py              # ‚Üí Should be in src/

# ‚úÖ REQUIRED - Proper organization
./scripts/my-script.sh
./docs/api-docs.md
./tests/conftest.py
./config/config.json
./src/util.py
```

**Reason**: File clutter makes projects hard to navigate, reduces professionalism, and violates standard project structure conventions.

## Code Quality Standards

### Configuration Management
- All configuration MUST come from environment variables
- Use fail-fast loading: raise clear errors for missing required config
- No hardcoded URLs, ports, database connections, API keys, or service names
- Use centralized configuration modules with type checking

### Security Requirements
- Never commit secrets, API keys, or credentials
- No hardcoded connection strings with embedded credentials
- All sensitive values must be injected via environment variables
- Use secure defaults only for non-sensitive optional parameters

### Development Workflow
- Run `make lint` and `make test` before commits
- Pre-commit hooks enforce hardcoded value detection
- All code changes must pass automated quality gates
- Follow existing patterns and conventions in the codebase

## Project Structure

```
solution-desk-engine/
‚îú‚îÄ‚îÄ src/              # Source code
‚îú‚îÄ‚îÄ tests/            # Test files
‚îú‚îÄ‚îÄ docs/             # Documentation with specialized context
‚îÇ   ‚îú‚îÄ‚îÄ vision/       # Project vision and strategic context
‚îÇ   ‚îú‚îÄ‚îÄ architecture/ # System design and technical constraints
‚îÇ   ‚îî‚îÄ‚îÄ standards/    # Code quality and development practices
‚îú‚îÄ‚îÄ scripts/          # Utility scripts
‚îú‚îÄ‚îÄ config/           # Configuration files
‚îú‚îÄ‚îÄ scratch/          # Temporary workspace (git-ignored)
‚îú‚îÄ‚îÄ .env.example      # Environment variable template
‚îú‚îÄ‚îÄ Makefile          # Standard automation targets
‚îî‚îÄ‚îÄ README.md         # Project overview
```

## Specialized Documentation Context

This project uses hierarchical documentation with specialized AI context:

- **Global Context** (this file): Project-wide constraints and principles
- **docs/vision/CLAUDE.md**: Strategic context for feature development
- **docs/architecture/CLAUDE.md**: Technical constraints and design patterns
- **docs/standards/CLAUDE.md**: Code quality and security requirements

When working in specific areas, Claude will automatically load the relevant context from subdirectory CLAUDE.md files.

---

## Development Commands

This project uses Poetry and make for development workflow:

### Essential Commands
- `make run` - Start FastAPI development server with auto-reload
- `make test` - Run pytest test suite
- `make test-cov` - Run tests with coverage reporting (minimum 80%)
- `make format` - Format code with black and isort
- `make lint` - Lint with flake8, ruff, and pylint
- `make typecheck` - Type check with mypy
- `make quality` - Run all quality checks (format + lint + typecheck + security)

### Genesis Integration
- `make genesis-commit MSG="message"` - Smart commit with quality gates
- `make genesis-status` - Check project health
- `make worktree-create NAME=feature FOCUS=src/` - Create AI-safe worktree

### Manual Poetry Commands (if needed)
- `poetry run uvicorn solution_desk_engine.main:app --reload` - Start server directly
- `poetry run pytest` - Run tests directly
- `poetry run pytest tests/test_main.py::test_function` - Run specific test

## Architecture Overview

### Core Components
- **FastAPI Application** (`src/solution_desk_engine/main.py`): Main API with health checks and root endpoint
- **Shared Core Integration**: Uses Genesis `shared-core` utilities for logging, environment variables, health checks
- **Configuration**: Fail-fast environment loading with `get_required_env()` and `get_optional_env()`
- **Health Monitoring**: Built-in health check endpoint at `/health` with detailed status

### Key Patterns
- **Environment Variables**: All config comes from env vars, loaded with fail-fast behavior
- **Logging**: Structured logging using `shared_core.get_logger()`
- **Health Checks**: Production-ready health monitoring with `HealthCheck` class
- **Type Safety**: Full mypy type checking with strict configuration
- **Error Handling**: Clear error messages for missing configuration

### Project Structure
```
src/solution_desk_engine/     # Main application package
‚îú‚îÄ‚îÄ main.py                   # FastAPI app with endpoints
‚îî‚îÄ‚îÄ __init__.py              # Package initialization
tests/                       # Test files using pytest
‚îú‚îÄ‚îÄ test_main.py            # Main application tests
```

### Dependencies
- **FastAPI**: Web framework with automatic OpenAPI docs
- **Pydantic**: Data validation and settings management
- **shared-core**: Genesis utilities (logging, env, health checks)
- **uvicorn**: ASGI server for development and production

**This project was created with Genesis - a development toolkit that enforces professional standards and security best practices.**
